<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ Ø¨Ø§Ø²ÛŒ Ø±ÛŒØ§Ø¶ÛŒ Ù…ÛŒÙˆÙ‡â€ŒÙ‡Ø§ ğŸŒğŸ¥¥</title>
<style>
  body {
    font-family: "Vazir", sans-serif;
    text-align: center;
    background: linear-gradient(to right, #5ee7df, #b490ca);
    color: #222;
    direction: rtl;
    overflow-x: hidden;
  }
  .hidden { display: none; }
  h1 { margin-top: 20px; }
  .menu-btn {
    font-size: 1.4em;
    padding: 10px 20px;
    margin: 10px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  .level-btn {
    display: inline-block;
    width: 70px;
    height: 70px;
    margin: 10px;
    border-radius: 50%;
    font-size: 1.3em;
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .level-btn:hover { transform: scale(1.1); }
  .locked { background: #777; color: #eee; cursor: not-allowed; }
  .unlocked { background: #fff; color: #222; }
  #timer, #lives, #score {
    font-size: 1.2em;
    margin: 5px;
  }
  #timer span { background: #ff5f5f; color: #fff; padding: 5px 10px; border-radius: 8px; }
  input {
    font-size: 1.2em;
    padding: 5px 10px;
    text-align: center;
  }
  img { width: 50px; vertical-align: middle; }
  button { cursor: pointer; }
</style>
</head>
<body>

<h1>ğŸ Ø¨Ø§Ø²ÛŒ Ø±ÛŒØ§Ø¶ÛŒ Ù…ÛŒÙˆÙ‡â€ŒÙ‡Ø§ ğŸŒğŸ¥¥</h1>

<!-- ğŸ  Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ -->
<div id="mainMenu">
  <button class="menu-btn" onclick="openLevelMenu()">ğŸ§© Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø±Ø­Ù„Ù‡</button>
  <button id="musicBtn" class="menu-btn" onclick="toggleMusic()">ğŸ”Š Ù…ÙˆØ²ÛŒÚ©</button>
</div>

<!-- ğŸ”¢ Ù…Ù†ÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø±Ø­Ù„Ù‡ -->
<div id="levelMenu" class="hidden">
  <h2>ğŸ§® Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø±Ø­Ù„Ù‡</h2>
  <div id="levels"></div>
  <button class="menu-btn" onclick="backToMain()">â¬… Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>

<!-- ğŸ® ØµÙØ­Ù‡â€ŒÛŒ Ø¨Ø§Ø²ÛŒ -->
<div id="game" class="hidden">
  <div id="info">
    <div id="timer">â± Ø²Ù…Ø§Ù†: <span id="time">30</span></div>
    <div id="lives">â¤ï¸â¤ï¸â¤ï¸</div>
    <div id="score">â­ Ø§Ù…ØªÛŒØ§Ø²: <span id="scoreValue">0</span></div>
    <div>ğŸ“ˆ Ù…Ø±Ø­Ù„Ù‡: <span id="levelNum">1</span></div>
  </div>

  <div id="equations"></div>

  <div class="equation">
    <input type="number" id="answer">
    <button onclick="checkAnswer()">Ø¨Ø±Ø±Ø³ÛŒ</button>
  </div>

  <p id="result"></p>
</div>

<!-- ğŸµ ØµØ¯Ø§Ù‡Ø§ -->
<audio id="bgMusic" loop><source src="background.mp3" type="audio/mpeg"></audio>
<audio id="soundWin" src="win.mp3"></audio>
<audio id="soundWrong" src="wrong.mp3"></audio>
<audio id="soundLose" src="lose.mp3"></audio>

<script>
// ğŸ® Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
let apple, banana, coconut, correctAnswer;
let timeLeft, timerInterval;
let lives = 3;
let score = 0;
let level = 1;
let musicPlaying = false;
let maxUnlocked = Number(localStorage.getItem("maxUnlocked") || 1);

// ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
function backToMain() {
  document.getElementById("levelMenu").classList.add("hidden");
  document.getElementById("mainMenu").classList.remove("hidden");
}

// ğŸ§© Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø±Ø­Ù„Ù‡
function openLevelMenu() {
  document.getElementById("mainMenu").classList.add("hidden");
  document.getElementById("levelMenu").classList.remove("hidden");
  generateLevelButtons();
}

// ğŸ”˜ Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒÙ‡Ø§
function generateLevelButtons() {
  const levelsDiv = document.getElementById("levels");
  levelsDiv.innerHTML = "";
  for (let i = 1; i <= 10; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.className = "level-btn " + (i <= maxUnlocked ? "unlocked" : "locked");
    if (i <= maxUnlocked) btn.onclick = () => startGame(i);
    levelsDiv.appendChild(btn);
  }
}

// â–¶ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø§Ø² Ù…Ø±Ø­Ù„Ù‡ Ù…Ø´Ø®Øµ
function startGame(selectedLevel) {
  level = selectedLevel;
  document.getElementById("levelNum").textContent = level;
  document.getElementById("levelMenu").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  resetGame();
  generateEquations();
  startTimer();
}

// ğŸ² Ø³Ø§Ø®Øª Ù…Ø¹Ø§Ø¯Ù„Ù‡â€ŒÙ‡Ø§
function generateEquations() {
  const range = 10 + level * 5;
  apple = getRandom(5, range);
  banana = getRandom(2, apple);
  coconut = getRandom(1, banana);
  correctAnswer = apple + banana + coconut;

  const eqDiv = document.getElementById("equations");
  eqDiv.innerHTML = `
    <div class="equation">ğŸ + ğŸ + ğŸ = ${apple * 3}</div>
    <div class="equation">ğŸ + ğŸŒ + ğŸŒ = ${apple + banana * 2}</div>
    <div class="equation">ğŸŒ - ğŸ¥¥ = ${banana - coconut}</div>
    <div class="equation">ğŸ¥¥ + ğŸ + ğŸŒ = ?</div>
  `;
}

// âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø®
function checkAnswer() {
  const answer = Number(document.getElementById("answer").value);
  const resultEl = document.getElementById("result");

  if (answer === correctAnswer) {
    clearInterval(timerInterval);
    playSound("win");
    showParticles("ğŸ‰");
    resultEl.textContent = "âœ… Ø¹Ø§Ù„ÛŒ! Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³ØªÙ‡!";
    resultEl.style.color = "green";
    score += 10 * level;
    document.getElementById("scoreValue").textContent = score;
    disableGame();
    unlockNextLevel();
    setTimeout(backToLevelMenu, 2500);
  } else {
    lives--;
    updateLives();
    playSound("wrong");
    showParticles("ğŸ’”");
    resultEl.textContent = "âŒ Ø§Ø´ØªØ¨Ø§Ù‡Ù‡! Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†.";
    resultEl.style.color = "red";
    if (lives <= 0) {
      clearInterval(timerInterval);
      playSound("lose");
      showParticles("ğŸ’€");
      gameOver("ğŸ’€ Ø¨Ø§Ø®ØªÛŒ!");
    }
  }
}

// ğŸ¯ Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø±Ø¯ØŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø±Ø­Ù„Ù‡
function backToLevelMenu() {
  document.getElementById("game").classList.add("hidden");
  document.getElementById("levelMenu").classList.remove("hidden");
  generateLevelButtons();
}

// ğŸ”“ Ø¢Ø²Ø§Ø¯ Ú©Ø±Ø¯Ù† Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯
function unlockNextLevel() {
  if (level >= maxUnlocked && level < 10) {
    maxUnlocked++;
    localStorage.setItem("maxUnlocked", maxUnlocked);
  }
}

// â± ØªØ§ÛŒÙ…Ø±
function startTimer() {
  timeLeft = Math.max(10, 30 - level * 2);
  document.getElementById("time").textContent = timeLeft;
  timerInterval = setInterval(() => {
    timeLeft--;
    document.getElementById("time").textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      playSound("lose");
      showParticles("ğŸ’€");
      gameOver("â° Ø²Ù…Ø§Ù† ØªÙ…ÙˆÙ… Ø´Ø¯!");
    }
  }, 1000);
}

// â™» Ø±ÛŒØ³Øª Ø¨Ø§Ø²ÛŒ
function resetGame() {
  clearInterval(timerInterval);
  lives = 3;
  document.getElementById("answer").disabled = false;
  document.querySelector("#game button").disabled = false;
  updateLives();
  document.getElementById("result").textContent = "";
}

// â¤ï¸ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø§Ù†â€ŒÙ‡Ø§
function updateLives() {
  const hearts = "â¤ï¸".repeat(lives) + "ğŸ¤".repeat(3 - lives);
  document.getElementById("lives").innerHTML = hearts;
}

// ğŸš« ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
function disableGame() {
  document.getElementById("answer").disabled = true;
  document.querySelector("#game button").disabled = true;
}

// ğŸ”š Ø¨Ø§Ø®Øª Ú©Ø§Ù…Ù„
function gameOver(msg) {
  disableGame();
  document.getElementById("result").textContent = msg;
  document.getElementById("result").style.color = "red";
  setTimeout(backToLevelMenu, 3000);
}

// ğŸµ Ú©Ù†ØªØ±Ù„ Ù…ÙˆØ²ÛŒÚ©
function toggleMusic() {
  const music = document.getElementById("bgMusic");
  const btn = document.getElementById("musicBtn");
  if (musicPlaying) {
    music.pause();
    btn.textContent = "ğŸ”ˆ Ù…ÙˆØ²ÛŒÚ©";
  } else {
    music.play();
    btn.textContent = "ğŸ”Š ØªÙˆÙ‚Ù Ù…ÙˆØ²ÛŒÚ©";
  }
  musicPlaying = !musicPlaying;
}

// ğŸ”Š ØµØ¯Ø§Ù‡Ø§
function playSound(type) {
  const sounds = {
    win: document.getElementById("soundWin"),
    wrong: document.getElementById("soundWrong"),
    lose: document.getElementById("soundLose")
  };
  const s = sounds[type];
  if (s) { s.currentTime = 0; s.play(); }
}

// ğŸ‡ Ù¾Ø§Ø±ØªÛŒÚ©Ù„â€ŒÙ‡Ø§
function showParticles(emoji) {
  for (let i = 0; i < 50; i++) {
    const p = document.createElement("div");
    p.textContent = emoji;
    p.style.position = "fixed";
    p.style.left = Math.random() * 100 + "vw";
    p.style.top = "-10px";
    p.style.fontSize = Math.random() * 24 + 12 + "px";
    p.style.animation = `fall ${2 + Math.random() * 3}s linear`;
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 4000);
  }
}
const style = document.createElement("style");
style.textContent = `@keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }`;
document.head.appendChild(style);

// ğŸ² Ø¹Ø¯Ø¯ ØªØµØ§Ø¯ÙÛŒ
function getRandom(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
</script>
</body>
</html>
