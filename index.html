<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>ğŸ Fruit Math Game ğŸ‰</title>
<style>
body {
  font-family: 'Vazir', sans-serif;
  background: linear-gradient(to bottom, #f0f8ff, #cce7ff);
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.screen {
  display:none;
  width: 90%;
  max-width: 600px;
  text-align:center;
}

.active {
  display:block;
}

h1, h2, h3 {
  margin: 10px 0;
  color: #333;
}

.level-button {
  margin:5px;
  padding:12px 18px;
  font-size:18px;
  cursor:pointer;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 8px;
  transition: 0.2s;
}

.level-button:hover {
  background-color: #45a049;
}

.locked {
  opacity:0.4;
  cursor: not-allowed;
  background-color: #999;
}

#game-container {
  margin-top:20px;
}

#equation {
  font-size: 28px;
  line-height: 1.5;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  display: inline-block;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

#answers input {
  font-size: 24px;
  width:120px;
  text-align:center;
  padding: 10px;
  border: 2px solid #ddd;
  border-radius: 8px;
}

#answers button {
  font-size: 24px;
  padding: 10px 20px;
  margin-left: 10px;
  background-color: #008CBA;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

#answers button:hover {
  background-color: #0079a1;
}

#hints button {
  margin:5px;
  padding:10px 25px;
  font-size:18px;
  background-color: #f44336;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

#hints button:hover {
  background-color: #d7372a;
}

#top-bar {
  display:flex;
  justify-content:space-around;
  font-size:18px;
  margin-top:20px;
  background: #333;
  color: white;
  padding: 12px 0;
  border-radius: 8px;
}

.particle {
  position:absolute;
  font-size:24px;
  animation: rise 1s ease-out forwards;
}

@keyframes rise {
  0% { opacity:1; transform: translateY(0) scale(1); }
  100% { opacity:0; transform: translateY(-100px) scale(1.5); }
}
</style>
</head>
<body>

<div id="menu-screen" class="screen active">
  <h1>ğŸ Fruit Math Game ğŸ‰</h1>
  <h3>ÙØµÙ„â€ŒÙ‡Ø§</h3>
  <div id="seasons"></div>
</div>

<div id="season-screen" class="screen">
  <h2 id="season-title"></h2>
  <div id="levels"></div>
  <button class="level-button" style="background-color: #555;" onclick="backToMenu()">ğŸ”™ Ø¨Ø±Ú¯Ø´Øª</button>
</div>

<div id="game-screen" class="screen">
  <div id="top-bar">
    <span id="time">â± Time: 20</span>
    <span id="lives">â¤ï¸â¤ï¸â¤ï¸</span>
    <span id="score">â­ Score: 0</span>
    <span id="level-num">ğŸ“ˆ Level: 1</span>
  </div>
  <div id="game-container">
    <div id="equation"></div>
    <div id="answers">
      <input type="number" id="answer" placeholder="Ø¬ÙˆØ§Ø¨">
      <button onclick="checkAnswer()">âœ”ï¸</button>
    </div>
    <div id="hints">
      <button onclick="showHint()">ğŸ’¡ Hint</button>
      <button onclick="addTimeWithAd()">â± Add Time</button>
    </div>
  </div>
</div>

<audio id="correct-sound" src="https://freesound.org/data/previews/320/320655_5260877-lq.mp3"></audio>
<audio id="wrong-sound" src="https://freesound.org/data/previews/109/109662_945474-lq.mp3"></audio>
<audio id="gameover-sound" src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3"></audio>

<script>
// Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
const fruits = ["ğŸ","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ", "ğŸ“"]; 
let timer = 20, lives = 3, score = 0;
let currentLevel = 0, currentSeason = 0;
let currentEquation, timerInterval;

// *******************************************************
// ØªÙˆÙ„ÛŒØ¯ Ù…Ø±Ø§Ø­Ù„ Ø­Ù„â€ŒÙ¾Ø°ÛŒØ±
// *******************************************************
function generateLevels(count) {
    const generatedLevels = [];
    for (let i = 0; i < count; i++) {
        const fruitValues = {};
        let availableFruits = [...fruits];
        const neededFruits = [];
        for(let j=0;j<3;j++){ 
            const index = Math.floor(Math.random() * availableFruits.length);
            neededFruits.push(availableFruits[index]);
            availableFruits.splice(index, 1); 
        }

        neededFruits.forEach(f => {
            if (!(f in fruitValues)) {
                fruitValues[f] = Math.floor(Math.random() * 8) + 2; 
            }
        });

        const f = neededFruits[0], g = neededFruits[1], h = neededFruits[2];
        const val_f = fruitValues[f], val_g = fruitValues[g], val_h = fruitValues[h];

        const line1 = `${f} + ${f} + ${f} = ${val_f * 3}`; 
        const line2 = `${g} + ${g} + ${f} = ${(val_g * 2) + val_f}`; 
        const line3 = `${h} + ${f} - ${g} = ${val_h + val_f - val_g}`;
        const line4 = `${f} * ${g} - ${h} = ?`;
        const finalAnswer = (val_f * val_g) - val_h;

        generatedLevels.push({lines:[line1,line2,line3,line4], answer:finalAnswer, fruitValues:fruitValues});
    }
    return generatedLevels;
}

const levels = generateLevels(100);

// *******************************************************
// Ù…Ù†Ùˆ Ùˆ ÙØµÙ„â€ŒÙ‡Ø§
// *******************************************************
function initMenu(){
  let seasonsDiv = document.getElementById("seasons");
  seasonsDiv.innerHTML = '';
  for(let s=0;s<4;s++){
    let btn = document.createElement("button");
    btn.innerText = `ÙØµÙ„ ${s+1}`;
    btn.className="level-button";
    btn.onclick = ()=> openSeason(s);
    seasonsDiv.appendChild(btn);
  }
}

function openSeason(season){
  currentSeason = season;
  document.getElementById("menu-screen").classList.remove("active");
  document.getElementById("season-screen").classList.add("active");
  document.getElementById("season-title").innerText = `ÙØµÙ„ ${season+1}`;
  let levelsDiv = document.getElementById("levels");
  levelsDiv.innerHTML="";
  for(let i=0;i<25;i++){
    let globalIndex = season*25+i;
    let btn = document.createElement("button");
    btn.className="level-button";
    btn.innerText = `Ù…Ø±Ø­Ù„Ù‡ ${i+1}`;
    if(globalIndex > score){ 
        btn.classList.add("locked"); 
        btn.disabled=true; 
    }
    btn.onclick = ()=> startLevel(globalIndex);
    levelsDiv.appendChild(btn);
  }
}

function backToMenu(){
    clearInterval(timerInterval); 
    document.getElementById("season-screen").classList.remove("active");
    document.getElementById("game-screen").classList.remove("active");
    document.getElementById("menu-screen").classList.add("active");
    openSeason(currentSeason);
}

function updateTopBar(){
  document.getElementById("time").innerText="â± Time: "+timer;
  document.getElementById("lives").innerText="â¤ï¸".repeat(lives);
  document.getElementById("score").innerText="â­ Score: "+score;
}

function runTimer() {
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timer--;
        updateTopBar();
        if (timer <= 0) {
            clearInterval(timerInterval);
            gameOver(true); 
        }
    }, 1000);
}

function startLevel(levelIndex){
  currentLevel = levelIndex;
  currentEquation = levels[levelIndex];
  document.getElementById("season-screen").classList.remove("active");
  document.getElementById("game-screen").classList.add("active");
  document.getElementById("equation").innerHTML = currentEquation.lines.join("<br>");
  document.getElementById("level-num").innerText = "ğŸ“ˆ Level: " + (levelIndex+1);
  timer = 20; lives=3; updateTopBar();
  runTimer();
}

function checkAnswer(){
  let user = Number(document.getElementById("answer").value);
  document.getElementById("answer").value='';

  if(user===currentEquation.answer){
    score++; 
    updateTopBar();
    playCorrect();
    showParticles("ğŸ‰");
    alert("ğŸ‰ Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª!");
    clearInterval(timerInterval); 
    backToMenu(); // â† Ø¨Ø¹Ø¯ Ø§Ø² Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³Øª Ø­ØªÙ…Ø§Ù‹ Ø¨Ù‡ Ù…Ù†Ùˆ Ø¨Ø±Ú¯Ø±Ø¯
  } else {
    lives--; 
    updateTopBar();
    playWrong();
    showParticles("âŒ");
    if(lives<=0) gameOver(false); 
    else alert("âŒ Ø¬ÙˆØ§Ø¨ Ø§Ø´ØªØ¨Ø§Ù‡. Ø¬Ø§Ù† Ø¨Ø§Ù‚ÛŒ: "+lives);
  }
}

function gameOver(isTimeOut){ 
  playGameOver();
  showParticles("ğŸ’€");
  clearInterval(timerInterval);
  alert(isTimeOut?"ğŸ’€ Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯!":"ğŸ’€ Ø¬Ø§Ù†â€ŒÙ‡Ø§ ØªÙ…Ø§Ù… Ø´Ø¯!");
  backToMenu(); // â† Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø§Ø®Øª Ø¨Ù‡ Ù…Ù†Ùˆ Ø¨Ø§Ø²Ú¯Ø±Ø¯
}

function showHint(){
  const availableFruits = Object.keys(currentEquation.fruitValues);
  if(availableFruits.length === 0) return alert("Ù‡ÛŒÚ† Ù…ÛŒÙˆÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡ÛŒÙ†Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª!");
  const f = availableFruits[Math.floor(Math.random()*availableFruits.length)];
  const val = currentEquation.fruitValues[f];
  alert(`ğŸ’¡ Ø±Ø§Ù‡Ù†Ù…Ø§: Ù…Ù‚Ø¯Ø§Ø± Ù…ÛŒÙˆÙ‡ ${f} Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ ${val} Ø§Ø³Øª.`);
}

function addTimeWithAd(){
  alert("ğŸ¬ Ù†Ù…Ø§ÛŒØ´ ØªØ¨Ù„ÛŒØº...");
  setTimeout(()=>{
    timer+=10;
    updateTopBar();
    alert("â± Ø²Ù…Ø§Ù† Û±Û° Ø«Ø§Ù†ÛŒÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!");
  },2000);
}

// *******************************************************
// ØµØ¯Ø§ Ùˆ Ù¾Ø§Ø±ØªÛŒÚ©Ù„
// *******************************************************
function playCorrect(){ document.getElementById("correct-sound").play(); }
function playWrong(){ document.getElementById("wrong-sound").play(); }
function playGameOver(){ document.getElementById("gameover-sound").play(); }

function showParticles(symbol){
  for(let i=0;i<20;i++){
    const p = document.createElement("div");
    p.className="particle";
    p.style.left = Math.random()*window.innerWidth+"px";
    p.style.top = Math.random()*window.innerHeight+"px";
    p.innerText = symbol;
    document.body.appendChild(p);
    setTimeout(()=>{ p.remove(); },1000);
  }
}

initMenu();
</script>

</body>
</html>
